!function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function n(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||((i=i||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function i(e,t){return null===(e=document.querySelector(e))||void 0===e?void 0:e.getAttribute(t)}function r(e){return i(e,"content")}var o,a,c,s=function(){return i("html","xml:lang")||i("html","lang")||r('meta[property="og:locale"]')},u=function(){return""+window.location.origin+window.location.pathname+window.location.search},l=function(){return r('meta[property="aiturec:item_id"]')||window.location.pathname},d=function(){return r('meta[property="aiturec:is_article"]')||("article"===r('meta[property="og:type"]')?"true":void 0)},f=function(){return r('meta[property="aiturec:is_inform"]')};(Z=o=o||{}).Get="GET",Z.Post="POST",(J=a=a||{}).Visit="p_visit",J.Ping="p_ping",(c=c||{}).Config="config";var v=/([\.$?*|{}\(\)\[\]\\\/\+^])/g;function p(e){return(e=document.cookie.match(new RegExp("(?:^|; )"+e.replace(v,"\\$1")+"=([^;]*)")))?decodeURIComponent(e[1]):void 0}function h(e,n,i){var r=t({path:"/",domain:window.location.hostname.split(".").slice(-2).join("."),"max-age":31536e3},i),o=encodeURIComponent(e)+"="+encodeURIComponent(n);return Object.keys(r).forEach((function(e){o+="; "+e,!0!==(e=r[e])&&(o+="="+e)})),document.cookie=o,n}function m(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var i=16*Math.random();return 0<e?(i=(e+i)%16|0,e=Math.floor(e/16)):(i=(t+i)%16|0,t=Math.floor(t/16)),("x"===n?i:3&i|8).toString(16)}))}var w,y="_ainewsb2b_uid",b="_ainewsb2b_debug_mode";function g(){var e=p(b);e&&"true"===e||h(b,"true")}function _(){var e=p(b);e&&"false"!==e&&h(b,"",{"max-age":-1})}function E(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];window.aiturecSharedData.isDebugModeSet&&console[e].apply(console,n([t],i))}function T(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return E.apply(void 0,n([w.Log],e))}function I(e,t){return E(w.Group,(t=void 0===t||t)?"[Metrics Track]: "+e:e),0}function S(e){if(1!==(e=void 0===e?1:e))for(var t=0;t<e;t+=1)E(w.GroupEnd);else E(w.GroupEnd)}(Z={}).Log="log",Z.Warn="warn",Z.Error="error",(J=w=w||{}).Log="log",J.Warn="warn",J.Error="error",J.Group="group",J.GroupEnd="groupEnd";var k=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return E.apply(void 0,n([w.Error,new Error(e)],t))},C=(Z="/metrics/v1")+"/event",x=(Object.defineProperty(j.prototype,"isConnectionClosed",{get:function(){var e;return(null===(e=this.socket)||void 0===e?void 0:e.readyState)===WebSocket.CLOSED||(null===(e=this.socket)||void 0===e?void 0:e.readyState)===WebSocket.CLOSING},enumerable:!1,configurable:!0}),j.prototype.onConnect=function(e){var t,n=this;this.socket=new WebSocket((null===(t=null===(t=window.metricsTrackData)||void 0===t?void 0:t.apiUrl)||void 0===t?void 0:t.replace("http","ws"))+"/metrics/v1/ws/event"),this.socket.onopen=function(){T("ws opened"),e&&n.onSend(e,"ws opened > ws sent")},this.socket.onmessage=function(e){var t;null!==(t=n.onMessage)&&void 0!==t&&t.call(n,e)},this.socket.onclose=function(e){I("ws closed"),e.wasClean?k("[close] Соединение закрыто чисто, код="+e.code+" причина="+e.reason):k("[close] Соединение прервано, код="+e.code+" причина="+e.reason),S()},this.socket.onerror=function(e){var t;null!==(t=n.socket)&&void 0!==t&&t.close(),k("[error] "+e)}},j.prototype.onSend=function(e,t){var n;void 0===t&&(t="ws sent"),e instanceof Error?k("[error] "+e):(null!==(n=this.socket)&&void 0!==n&&n.send(JSON.stringify(e)),T(t,e))},j.prototype.onClose=function(){var e;null!==(e=this.socket)&&void 0!==e&&e.close()},j);function j(e){this.socket=null,this.onMessage=e}var O=function(e){return'Property "'+e+'" cannot be empty'};function P(){var e=window.metricsTrackData.spaReferer||document.referrer,t=navigator.language;return{viewport_height:window.innerHeight,viewport_width:window.innerWidth,referer:e,browser_lang:t}}function V(e,n){var i=l();if(!i)return new Error(O("item_id"));var r=s();if(!r)return new Error(O("lang"));var o=window.aiturecSharedData.uid;if(!o)return new Error(O("user_id"));var c=window.metricsTrackData.projectId;if(!c)return new Error(O("project_id"));var v=u(),p=d(),h=f();return{data:{id:m(),type:"events",attributes:t(t({event_type:e,project_id:c,user_id:o,item_id:i,url:v,lang:r,is_article:p,is_inform:h},n&&t({},n)),e===a.Visit?P():{})}}}var D=setTimeout;function N(e){return Boolean(e&&void 0!==e.length)}function U(){}function A(e){if(!(this instanceof A))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],F(e,this)}function L(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,A._immediateFn((function(){var n,i=1===e._state?t.onFulfilled:t.onRejected;if(null!==i){try{n=i(e._value)}catch(n){return void M(t.promise,n)}R(t.promise,n)}else(1===e._state?R:M)(t.promise,e._value)}))):e._deferreds.push(t)}function R(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof A)return e._state=3,e._value=t,void W(e);if("function"==typeof n)return void F((i=n,r=t,function(){i.apply(r,arguments)}),e)}e._state=1,e._value=t,W(e)}catch(t){M(e,t)}var i,r}function M(e,t){e._state=2,e._value=t,W(e)}function W(e){2===e._state&&0===e._deferreds.length&&A._immediateFn((function(){e._handled||A._unhandledRejectionFn(e._value)}));for(var t=0,n=e._deferreds.length;t<n;t++)L(e,e._deferreds[t]);e._deferreds=null}function B(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function F(e,t){var n=!1;try{e((function(e){n||(n=!0,R(t,e))}),(function(e){n||(n=!0,M(t,e))}))}catch(e){if(n)return;n=!0,M(t,e)}}function G(){return new A((function(e,n){var i=l();if(!i)return n(new Error(O("item_id")));var r=s();if(!r)return n(new Error(O("lang")));var c=window.aiturecSharedData.uid;if(!c)return n(new Error(O("user_id")));var v=window.metricsTrackData.projectId;if(!v)return n(new Error(O("project_id")));var p=u(),h=d(),m=f();return function(e){var t,n,i=new XMLHttpRequest,r=e.method===o.Post?(null===(t=window.metricsTrackData)||void 0===t?void 0:t.apiUrl)+"/"+e.path:""+(null===(t=window.metricsTrackData)||void 0===t?void 0:t.apiUrl)+e.path+"?"+((n=e.params)?Object.keys(n).filter((function(e){return void 0!==n[e]})).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])})).join("&"):"");return new A((function(t,n){var a;null!==(a=window.metricsTrackData)&&void 0!==a&&a.apiUrl||n(new Error("Api url cannot be empty")),i.open(e.method,r,!0),i.withCredentials=!0,e.method===o.Post&&i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onload=function(){if(200<=i.status&&i.status<400){201===i.status&&t(!0);try{var e=JSON.parse(i.responseText);t(e)}catch(e){n(e)}}else n(function(e){var t=e.status+": "+e.statusText;if(!e.response)return t;try{var n=JSON.parse(e.response);return n.errors&&Array.isArray(n.errors)&&n.errors.length?n.errors.map((function(t){return(t.title||e.status)+": "+(t.detail||e.statusText)}))[0]:t}catch(n){return t}}(i))},i.onerror=function(){n(new Error("An error occurred during the transaction"))},i.send(e.method===o.Post?JSON.stringify(e.body):void 0)}))}({method:o.Get,path:C,params:t({event_type:a.Visit,project_id:v,user_id:c,item_id:i,url:p,lang:r,is_article:h,is_inform:m},P())}).then((function(){return e(a.Visit)})).catch((function(e){return n(e)}))}))}A.prototype.catch=function(e){return this.then(null,e)},A.prototype.then=function(e,t){var n=new this.constructor(U);return L(this,new B(e,t,n)),n},A.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){return t.reject(n)}))}))},A.all=function(e){return new A((function(t,n){if(!N(e))return n(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var r=i.length,o=0;o<i.length;o++)!function e(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,(function(t){e(o,t)}),n)}i[o]=a,0==--r&&t(i)}catch(a){n(a)}}(o,i[o])}))},A.allSettled=function(e){return new this((function(t,n){if(!e||void 0===e.length)return n(new TypeError(typeof e+" "+e+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var r=i.length,o=0;o<i.length;o++)!function e(n,o){if(o&&("object"==typeof o||"function"==typeof o)){var a=o.then;if("function"==typeof a)return void a.call(o,(function(t){e(n,t)}),(function(e){i[n]={status:"rejected",reason:e},0==--r&&t(i)}))}i[n]={status:"fulfilled",value:o},0==--r&&t(i)}(o,i[o])}))},A.resolve=function(e){return e&&"object"==typeof e&&e.constructor===A?e:new A((function(t){t(e)}))},A.reject=function(e){return new A((function(t,n){n(e)}))},A.race=function(e){return new A((function(t,n){if(!N(e))return n(new TypeError("Promise.race accepts an array"));for(var i=0,r=e.length;i<r;i++)A.resolve(e[i]).then(t,n)}))},A._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){D(e,0)},A._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var $=(Object.defineProperty(H.prototype,"isVisible",{get:function(){return!document[this.documentPropertyName]},enumerable:!1,configurable:!0}),H.prototype.handleVisibilityChange=function(){var e;document[this.documentPropertyName]?null!==(e=this.onInvisible)&&void 0!==e&&e.call(this):null!==(e=this.onVisible)&&void 0!==e&&e.call(this)},H.prototype.init=function(){document.hidden,this.documentPropertyName="hidden",this.eventName="visibilitychange",document.addEventListener(this.eventName,this.handleVisibilityChange)},H.prototype.destroy=function(){document.removeEventListener(this.eventName,this.handleVisibilityChange)},H);function H(e,t){this.documentPropertyName="hidden",this.eventName="visibilitychange",this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.onVisible=e,this.onInvisible=t}var J="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},q="Expected a function",z=/^\s+|\s+$/g,K=/^[-+]0x[0-9a-f]+$/i,X=/^0b[01]+$/i,Q=/^0o[0-7]+$/i,Y=parseInt,Z="object"==typeof J&&J&&J.Object===Object&&J,ee=(J="object"==typeof self&&self&&self.Object===Object&&self,Z||J||Function("return this")()),te=Object.prototype.toString,ne=Math.max,ie=Math.min,re=function(){return ee.Date.now()};function oe(e){var t=typeof e;return e&&("object"==t||"function"==t)}function ae(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||(n=t)&&"object"==typeof n&&"[object Symbol]"==te.call(t))return NaN;var t,n;if("string"!=typeof(e=oe(e)?oe(i="function"==typeof e.valueOf?e.valueOf():e)?i+"":i:e))return 0===e?e:+e;e=e.replace(z,"");var i=X.test(e);return i||Q.test(e)?Y(e.slice(2),i?2:8):K.test(e)?NaN:+e}var ce=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError(q);return oe(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),function(e,t,n){var i,r,o,a,c,s,u=0,l=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError(q);function v(t){var n=i,o=r;return i=r=void 0,u=t,a=e.apply(o,n)}function p(e){var n=e-s;return void 0===s||t<=n||n<0||d&&o<=e-u}function h(){var e,n=re();if(p(n))return m(n);c=setTimeout(h,(n=t-((e=n)-s),d?ie(n,o-(e-u)):n))}function m(e){return c=void 0,f&&i?v(e):(i=r=void 0,a)}function w(){var e=re(),n=p(e);if(i=arguments,r=this,s=e,n){if(void 0===c)return u=n=s,c=setTimeout(h,t),l?v(n):a;if(d)return c=setTimeout(h,t),v(s)}return void 0===c&&(c=setTimeout(h,t)),a}return t=ae(t)||0,oe(n)&&(l=!!n.leading,o=(d="maxWait"in n)?ne(ae(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),w.cancel=function(){void 0!==c&&clearTimeout(c),i=s=r=c=void(u=0)},w.flush=function(){return void 0===c?a:m(re())},w}(e,t,{leading:i,maxWait:t,trailing:r})};Object.defineProperty(se.prototype,"eventsCount",{get:function(){return this.eventsCountValue},set:function(e){this.eventsCountValue=e,this.userEventsEmitter&&this.userEventsEmitter()},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"getUserEventInitStatus",{get:function(){return this.isUserEventsInit},enumerable:!1,configurable:!0}),se.prototype.initUserEvents=function(){window.addEventListener("pointermove",this.onEvent.bind(this),!1),window.addEventListener("scroll",this.onEvent.bind(this),!1),this.isUserEventsInit=!0},se.prototype.destroyUserEvents=function(){window.removeEventListener("pointermove",this.onEvent.bind(this)),window.removeEventListener("scroll",this.onEvent.bind(this))},J=se;function se(){var e=this;this.userEventsEmitter=void 0,this.isUserEventsInit=!1,this.eventsCountValue=0,this.onEvent=ce((function(){e.eventsCount+=1}),1e3)}var ue,le=(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(de,ue=J),de.prototype.clearIdleTimer=function(){clearTimeout(this.idleTimerId),this.idleTimerId=void 0,T("clear idle timer")},de.prototype.clearIntervalTimer=function(){clearInterval(this.intervalId),this.intervalId=void 0,T("clear interval timer")},de.prototype.init=function(){var e=this;function t(){e.pageVisibility.isVisible&&e.pageVisibility.onInvisible(),e.clearIdleTimer(),e.callback(Math.round(e.activeTimeCounter/1e3)),e.eventsCount=0}function n(){e.pageVisibility.isVisible?e.pageViewStartTime=Date.now():e.pageViewStartTime=0,e.activeTimeCounter=0}function i(){T("set idle timer"),e.idleTimerId=setTimeout((function(){e.pageVisibility.destroy(),e.disconnectCallback(),e.clearIntervalTimer(),e.userEventsEmitter=e.init,T("called idle timer")}),9e5)}this.intervalId&&this.clearIntervalTimer(),this.idleTimerId&&this.clearIdleTimer(),this.getUserEventInitStatus||this.initUserEvents(),this.userEventsEmitter&&(this.userEventsEmitter=void 0),this.pageVisibility.init(),this.timer=0,window.addEventListener("beforeunload",(function(){t(),e.destroy()})),n(),T("set first interval"),e.intervalId=setInterval((function(){e.timer+=5e3,I("first interval"),T("called"),3e4===e.timer&&(e.clearIntervalTimer(),T("set second interval"),e.intervalId=setInterval((function(){e.timer+=3e4,I("second interval"),T("called"),0!==e.eventsCount||e.idleTimerId?(t(),T("called callback")):i(),S(),n()}),3e4)),0!==e.eventsCount||e.idleTimerId?(t(),T("called callback")):i(),S(),n()}),5e3)},de.prototype.destroy=function(){this.destroyUserEvents(),this.pageVisibility.destroy(),this.clearIntervalTimer(),this.clearIdleTimer(),this.disconnectCallback()},de);function de(e,t){var n=ue.call(this)||this;return n.timer=0,n.pageViewStartTime=0,n.activeTimeCounter=0,n.intervalId=void 0,n.callback=e,n.disconnectCallback=t,n.pageVisibility=new $((function(){n.pageViewStartTime=Date.now()}),(function(){n.activeTimeCounter+=Date.now()-n.pageViewStartTime})),n}function fe(){var e,n,i;window.aiturecSharedData=t(t({},window.aiturecSharedData),{referrerItemId:l()}),function(){var e,t,n,i;e=window,t=document,n="script",e[i="dmpkitdl_metrics"]=e[i]||[],e=t.getElementsByTagName(n)[0],i="dmpkitdl"!==i?"&l="+i:"",(n=t.createElement(n)).async=!0,n.src="//dmp.dt.aitudala.kz/tm.js?id=42d07319-3c80-4fa2-8861-f5dac140192a"+i,e.parentNode.insertBefore(n,e)}(),window.WebSocket?(n=new x,i=new le((function(e){n.isConnectionClosed?n.onConnect(V(a.Ping,{view_duration:e})):n.onSend(V(a.Ping,{view_duration:e}))}),(function(){n.onClose()})),n.onConnect(V(a.Visit)),i.init(),null!==(e=null===(e=window.aiturecSharedObserver)||void 0===e?void 0:e.callbacks)&&void 0!==e&&e.set(a.Visit,(function(){n.isConnectionClosed?n.onConnect(V(a.Visit)):(n.onSend(V(a.Visit)),i.init())}))):(G().catch((function(e){return k(e)})),null!==(e=null===(e=window.aiturecSharedObserver)||void 0===e?void 0:e.callbacks)&&void 0!==e&&e.set(a.Visit,(function(){G().catch((function(e){return k(e)}))})))}function ve(){var e,n,i,r=window.metricsTrackDataLayer||[];null!==(n=window.aiturecSharedObserver)&&void 0!==n&&n.isObserved||(window.aiturecSharedObserver={callbacks:new Map,isObserved:(e={},n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,i=window.location.href,new n((function(){var n,r=l();r&&(null===(n=window.aiturecSharedData)||void 0===n?void 0:n.referrerItemId)!==r&&(window.aiturecSharedData=t(t({},window.aiturecSharedData),{referrerItemId:r}),null!==(r=null===(r=window.aiturecSharedObserver)||void 0===r?void 0:r.callbacks)&&void 0!==r&&r.forEach((function(t,n){clearTimeout(e[n]),e[n]=void 0,e[n]=window.setTimeout((function(){n===a.Visit&&(window.metricsTrackData.spaReferer=i,i=window.location.href),t()}),200)})))})).observe(document.head,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["content"],characterData:!1}),!0)}),r.length&&(r.forEach((function(e){e.service===c.Config&&function(e){var n=p(y)||h(y,m()),i=p(b);window.aiturecSharedData=t(t({},window.aiturecSharedData),{uid:n,isDebugModeSet:!!i&&"true"===i,onSetDebugMode:g,onUnsetDebugMode:_});var r=(a=t({},{env:{API_URL:"https://script.metrics.ainews.kz/api",APP_ENV:"prod",APP_VERSION:"v1",APP_BUNDLE_VERSION:"1.1.2",APP_BRANCH:"unknown"}}).env).API_URL,o=a.APP_ENV,a=(n=a.APP_BRANCH,i=a.APP_VERSION,a.APP_BUNDLE_VERSION);window.metricsTrackData=t(t({},window.metricsTrackData),{projectId:e,apiUrl:r,appEnv:o,appBranch:n,appVersion:i,appBundleVersion:a})}(e.projectId)})),(window.metricsTrack=fe)()),new Promise((function(e){var t;window.addEventListener("message",(function t(n){try{var i=JSON.parse(n.data);if("getId"!==i.event)return;e(i.value),window.removeEventListener("message",t)}catch(t){console.error(t)}}));var n=document.createElement("iframe");n.style.display="none",n.src=(null===(t=window.metricsTrackData.apiUrl)||void 0===t?void 0:t.slice(0,-3))+"v1/iframe.html",document.body.appendChild(n)})).then((function(e){window.metricsId=e}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ve):ve()}();